# ETFTool 功能路线图

> 基于现有功能体系的新功能规划
> 创建时间: 2026-02-07

---

## 当前功能概览

在规划新功能前，先梳理已实现的核心能力：

| 模块 | 已实现功能 |
|------|-----------|
| **数据基础** | ETF 搜索、实时行情、QFQ 历史数据、批量价格 |
| **分析指标** | CAGR、最大回撤、波动率、ATR、当前回撤 |
| **温度系统** | 5 因子市场温度（回撤/RSI/历史分位/波动率/趋势强度） |
| **趋势分析** | 日线（MA5/20/60）+ 周线（MA5/10/20）趋势信号 |
| **网格交易** | ATR 动态间距、上下界计算、网格数优化 |
| **告警系统** | 温度变化/RSI/均线交叉/周线反转 + Telegram 推送 |
| **自选管理** | 拖拽排序、下拉刷新、云端同步、紧凑指标 |
| **用户系统** | 注册登录、JWT 认证、管理员后台 |
| **PWA** | 主屏幕安装、全屏模式、safe-area 适配 |

---

## 新功能规划

### 一、投资决策增强（最高价值）

#### 1. ETF 对比功能

- **描述**: 选择 2-3 只 ETF，在同一张图上对比走势、收益率、回撤等核心指标
- **用户价值**: 选基金最核心的需求就是"选哪个更好"，横向对比是最直觉的决策方式
- **实现思路**:
  - 新增对比页面 `/compare`，支持从自选列表或搜索中添加对比标的
  - 走势图归一化处理（以起始日为基准 100%），消除绝对价格差异
  - 指标对比表格：CAGR、最大回撤、波动率、温度并排展示
  - 相关性系数计算（复用历史数据接口）
- **复杂度**: 中
- **优先级**: P0

#### 2. 定投回测模拟

- **描述**: 输入起始日期、每月定投金额，计算定投某只 ETF 的历史收益、年化回报、最大浮亏
- **用户价值**: 定投是散户最主流的 ETF 投资策略，"如果我从 X 年开始定投，现在赚了多少"是最常见的问题
- **实现思路**:
  - 后端新增 `/etf/{code}/backtest/dca` 接口（DCA = Dollar Cost Averaging）
  - 参数：起始日期、每期金额、定投频率（周/月）
  - 返回：总投入、当前市值、总收益率、年化收益率、最大浮亏、收益曲线
  - 前端在详情页新增"定投回测"卡片，支持参数调整和结果可视化
- **复杂度**: 中
- **优先级**: P0

#### 3. 持仓组合管理

- **描述**: 记录买入价格和份额，实时计算持仓盈亏、成本线、仓位占比
- **用户价值**: 从"看行情"升级到"管资产"，形成完整的投资工具闭环
- **实现思路**:
  - 新增 Portfolio 数据模型（用户、ETF 代码、买入价、份额、买入日期）
  - 支持多次买入记录，自动计算加权平均成本
  - 组合总览页：总市值、总盈亏、各持仓占比饼图
  - 详情页叠加成本线到走势图上
- **复杂度**: 高
- **优先级**: P1

#### 4. 板块/行业热力图

- **描述**: 按行业分类展示 ETF 涨跌热力图，一眼看出资金流向和板块轮动
- **用户价值**: 快速把握市场全局，发现投资机会
- **实现思路**:
  - 维护 ETF 行业分类映射表（宽基/行业/主题/商品/债券/货币）
  - 热力图组件：矩形面积代表规模，颜色代表涨跌幅
  - 支持按日/周/月切换时间维度
  - 点击板块可展开查看该分类下的具体 ETF
- **复杂度**: 中
- **优先级**: P2

---

### 二、数据分析深化

#### 5. 资金流向分析 ✅ 阶段1已实现

- **描述**: 展示 ETF 的净申购/赎回趋势，判断机构资金动向
- **用户价值**: ETF 独有的分析视角，申购赎回数据能反映机构态度
- **已实现（阶段1）**:
  - ✅ 通过 akshare 采集上交所/深交所 ETF 份额数据
  - ✅ 独立数据库存储份额历史
  - ✅ 当前规模（份额 × 价格）和规模排名
  - ✅ 详情页"资金流向"卡片展示
  - ✅ 管理员手动触发采集和 CSV 导出
  - ✅ APScheduler 每日自动采集（16:00 北京时间）
- **待实现（阶段2）**:
  - 份额变动趋势图表
  - 净申购/赎回金额计算
  - 大额申购/赎回事件标注
- **复杂度**: 中
- **优先级**: P1

#### 6. 相关性分析

- **描述**: 计算自选列表中 ETF 之间的相关系数矩阵，辅助分散投资
- **用户价值**: 帮助构建低相关性组合，避免"以为分散了实际高度相关"的陷阱
- **实现思路**:
  - 后端新增 `/etf/correlation` 接口，接收多个 ETF 代码
  - 使用 pandas 计算收益率相关系数矩阵
  - 前端展示热力图矩阵，颜色深浅表示相关程度
  - 可集成到对比功能中
- **复杂度**: 低
- **优先级**: P1（可与对比功能一起实现）

#### 7. 分红/拆分记录

- **描述**: 展示 ETF 历史分红、拆分事件，解释前复权价格跳变原因
- **用户价值**: 解答用户常见困惑——"为什么历史价格和我记忆中的不一样"
- **实现思路**:
  - 通过 akshare 获取 ETF 分红拆分数据
  - 在走势图上标注分红/拆分事件点
  - 详情页新增"历史事件"时间线卡片
- **复杂度**: 低
- **优先级**: P2

#### 8. 成交量分析

- **描述**: 在走势图上叠加成交量柱状图，支持量价配合分析
- **用户价值**: 技术分析的基础需求，量价关系是判断趋势可靠性的重要依据
- **实现思路**:
  - 历史数据接口已包含成交量字段，只需前端展示
  - ETFChart 组件新增成交量柱状图（底部叠加）
  - 涨日红色柱、跌日绿色柱
  - 支持开关显示/隐藏
- **复杂度**: 低
- **优先级**: P1

---

### 三、用户体验提升

#### 9. 自选分组/标签

- **描述**: 支持给自选 ETF 打标签或分组，如"核心持仓"、"观察中"、"行业"
- **用户价值**: 自选列表超过 10 只后管理痛点明显，分组是最自然的组织方式
- **实现思路**:
  - 扩展 Watchlist 数据模型，新增 `group` 或 `tags` 字段
  - 前端自选页支持按分组折叠/展开
  - 支持拖拽 ETF 到不同分组
  - 预设分组 + 自定义分组
- **复杂度**: 中
- **优先级**: P1

#### 10. 每日市场摘要推送

- **描述**: 每天收盘后通过 Telegram 推送一条消息，汇总自选列表的涨跌、温度变化、重要信号
- **用户价值**: 复用现有 Telegram 通道，用户无需打开 APP 就能掌握当日概况
- **实现思路**:
  - 复用 AlertScheduler，新增每日 15:30 的摘要任务
  - 汇总内容：自选涨跌排行、温度变化、触发的告警信号
  - 格式化为 Telegram HTML 消息
  - 用户可在告警设置中开关此功能
- **复杂度**: 低
- **优先级**: P0

#### 11. 价格到价提醒

- **描述**: 设置目标价格，到价后触发 Telegram 通知（如"沪深300 ETF 跌到 3.5 元提醒我"）
- **用户价值**: 最直觉的提醒需求，比技术指标告警更容易理解和使用
- **实现思路**:
  - 新增 PriceAlert 数据模型（用户、ETF 代码、目标价、方向上/下、是否触发）
  - 复用盘中检查调度器，每 30 分钟检查价格是否触及目标
  - 触发后发送 Telegram 通知，自动标记为已触发
  - 前端在详情页新增"设置到价提醒"入口
- **复杂度**: 低
- **优先级**: P0

#### 12. 快捷笔记/备忘

- **描述**: 在 ETF 详情页添加个人笔记，如"3.8 以下可以加仓"、"等回撤到 -15% 再买"
- **用户价值**: 轻量但实用，帮助用户记录投资逻辑，避免情绪化决策
- **实现思路**:
  - 扩展 Watchlist 模型或新增 Note 模型
  - 详情页底部新增笔记区域，支持简单文本编辑
  - 自选列表卡片上显示笔记摘要（如有）
  - 云端同步
- **复杂度**: 低
- **优先级**: P2

---

### 四、社交与信息

#### 13. 自选列表分享

- **描述**: 生成自选列表的分享图片或链接，方便社交传播
- **用户价值**: 有传播价值，可以带来新用户
- **实现思路**:
  - 前端生成分享卡片（Canvas 或 html2canvas）
  - 包含：自选列表、当日涨跌、温度概览
  - 支持保存为图片或复制链接
- **复杂度**: 低
- **优先级**: P2

#### 14. ETF 新闻/公告聚合

- **描述**: 聚合 ETF 相关的基金公告、调仓信息、重大事件
- **用户价值**: 信息完整性，减少用户在多个平台间切换
- **实现思路**:
  - 通过 akshare 或爬虫获取基金公告数据
  - 详情页新增"公告"标签页
  - 支持公告类型筛选（分红、调仓、清盘风险等）
- **复杂度**: 高
- **优先级**: P3

---

## 优先级总览

### P0 — 高价值低成本，建议优先实现

| # | 功能 | 复杂度 | 核心理由 |
|---|------|--------|---------|
| 10 | 每日市场摘要推送 | 低 | 复用 Telegram + 告警系统，开发量极小，用户感知极强 |
| 11 | 价格到价提醒 | 低 | 复用告警框架，最自然的用户需求 |
| 1 | ETF 对比功能 | 中 | 选基金的核心场景，差异化价值大 |
| 2 | 定投回测模拟 | 中 | 散户最关心的问题，后端已有历史数据基础 |

### P1 — 高价值，需要一定开发投入

| # | 功能 | 复杂度 | 核心理由 |
|---|------|--------|---------|
| 8 | 成交量分析 | 低 | 数据已有，仅需前端图表扩展 |
| 5 | 资金流向分析 | 中 | ETF 独有视角，差异化竞争力 |
| 6 | 相关性分析 | 低 | 可与对比功能捆绑实现 |
| 9 | 自选分组/标签 | 中 | 自选列表增长后的刚需 |
| 3 | 持仓组合管理 | 高 | 产品升级的关键一步 |

### P2 — 锦上添花

| # | 功能 | 复杂度 | 核心理由 |
|---|------|--------|---------|
| 4 | 板块/行业热力图 | 中 | 市场全局视角 |
| 7 | 分红/拆分记录 | 低 | 解答用户困惑 |
| 12 | 快捷笔记/备忘 | 低 | 轻量实用 |
| 13 | 自选列表分享 | 低 | 传播价值 |

### P3 — 远期规划

| # | 功能 | 复杂度 | 核心理由 |
|---|------|--------|---------|
| 14 | ETF 新闻/公告聚合 | 高 | 数据源复杂，维护成本高 |

---

## 建议实施路径

```
第一批（P0）: 每日摘要推送 → 到价提醒 → ETF 对比 → 定投回测
     ↓
第二批（P1）: 成交量图表 → 资金流向 → 相关性分析 → 自选分组
     ↓
第三批（P1）: 持仓组合管理
     ↓
第四批（P2）: 热力图 / 分红记录 / 笔记 / 分享
```

---

## 更新日志

- **2026-02-07**: 初始版本，基于项目现状分析和头脑风暴生成

---

**注意**: 此文档为功能规划路线图，具体实现前需创建对应的设计文档（`docs/design/`）。
