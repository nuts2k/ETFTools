# Baostock æ•°æ®æºè¯„ä¼°æŠ¥å‘Š

**ç ”ç©¶æ—¥æœŸ**: 2026-02-16
**ç ”ç©¶ç›®çš„**: è¯„ä¼° Baostock ä½œä¸ºä¸œæ–¹è´¢å¯Œæ¥å£æ›¿ä»£æ–¹æ¡ˆçš„å¯è¡Œæ€§
**ç ”ç©¶èƒŒæ™¯**: ä¸œæ–¹è´¢å¯Œæ¥å£ï¼ˆé€šè¿‡ AkShareï¼‰å­˜åœ¨ç¨³å®šæ€§é—®é¢˜ï¼Œé¢‘ç¹è§¦å‘åçˆ¬è™«ç­–ç•¥

---

## 1. æ‰§è¡Œæ‘˜è¦

**æ ¸å¿ƒç»“è®º**: Baostock **æ— æ³•å®Œå…¨æ›¿ä»£**ä¸œæ–¹è´¢å¯Œæ¥å£ï¼Œä½†å¯ä»¥ä½œä¸º**å†å²æ•°æ®çš„ä¸»è¦æ¥æº**ï¼Œæ˜¾è‘—æå‡ç¨³å®šæ€§ã€‚

**æ¨èæ–¹æ¡ˆ**: é‡‡ç”¨**æ··åˆä½¿ç”¨ç­–ç•¥** - Baostock ä½œä¸ºå†å²æ•°æ®ä¸»è¦æ¥æºï¼ŒAkShare ä¿ç•™ç”¨äºå®æ—¶è¡Œæƒ…å’Œç‰¹æ®Šæ•°æ®ï¼ˆä¼°å€¼ã€ä»½é¢ï¼‰ã€‚

**é¢„æœŸæ”¶ç›Š**:
- å†å²æ•°æ®è·å–ç¨³å®šæ€§æå‡ 60-80%
- é™ä½å¯¹å•ä¸€æ•°æ®æºçš„ä¾èµ–é£é™©
- å‡å°‘å› åçˆ¬è™«å¯¼è‡´çš„æœåŠ¡ä¸­æ–­

---

## 2. å½“å‰ä¸œæ–¹è´¢å¯Œæ¥å£ä½¿ç”¨æƒ…å†µ

### 2.1 æ ¸å¿ƒä¾èµ–æ¥å£

| æ¥å£ | åŠŸèƒ½ | ç”¨é€” | å…³é”®æ€§ |
|------|------|------|--------|
| `fund_etf_spot_em` | å®æ—¶è¡Œæƒ… | é¦–é¡µ ETF åˆ—è¡¨ã€è‡ªé€‰åˆ—è¡¨ | ğŸ”´ æ ¸å¿ƒ |
| `fund_etf_hist_em` | å†å²æ•°æ®ï¼ˆå‰å¤æƒï¼‰ | è¯¦æƒ…é¡µèµ°åŠ¿å›¾ã€æ”¶ç›Šç‡è®¡ç®— | ğŸ”´ æ ¸å¿ƒ |
| `stock_zh_index_value_csindex` | æŒ‡æ•°ä¼°å€¼ | PE ç™¾åˆ†ä½ã€ä¼°å€¼åˆ¤æ–­ | ğŸŸ¡ é‡è¦ |
| `fund_etf_scale_sse/szse` | ETF ä»½é¢ | èµ„é‡‘æµå‘åˆ†æ | ğŸŸ¡ é‡è¦ |

### 2.2 å·²çŸ¥ç¨³å®šæ€§é—®é¢˜

**é—®é¢˜è¡¨ç°**:
- é¢‘ç¹è§¦å‘åçˆ¬è™«ç­–ç•¥ï¼ˆé¢‘ç‡é™åˆ¶ã€äººæœºéªŒè¯ï¼‰
- å›½å¤–æœåŠ¡å™¨è®¿é—®å»¶è¿Ÿï¼ˆå·²è®¾ç½® 180 ç§’è¶…æ—¶ï¼‰
- è¿ç»­è°ƒç”¨æ—¶è¿”å› `None` æˆ–è¿æ¥ä¸­æ–­

**ç°æœ‰ç¼“è§£æªæ–½**:
- âœ… å¤šæºå¤‡ç”¨ï¼ˆSinaã€THSï¼‰
- âœ… é‡è¯•æœºåˆ¶ï¼ˆ2-3 æ¬¡ï¼Œ60 ç§’é—´éš”ï¼‰
- âœ… ç£ç›˜ç¼“å­˜ï¼ˆ7 å¤© + æ°¸ä¹…å…œåº•ï¼‰
- âœ… æœ¬åœ° JSON å…œåº•æ•°æ®
- âœ… User-Agent ä¼ªè£… + ä»£ç†ç¦ç”¨

**ä»£ç ä½ç½®**: `backend/app/services/akshare_service.py`

---

## 3. Baostock èƒ½åŠ›åˆ†æ

### 3.1 æ ¸å¿ƒç‰¹æ€§

**æ•°æ®æ¥æº**: è¯åˆ¸äº¤æ˜“æ‰€å®˜æ–¹æ¸ é“ï¼ˆéçˆ¬è™«ï¼‰
**ç¨³å®šæ€§**: é«˜ï¼ˆè¾ƒå°‘è§¦å‘è®¿é—®é™åˆ¶ï¼‰
**è´¹ç”¨**: å…è´¹å¼€æº
**API è®¾è®¡**: ç®€æ´æ˜“ç”¨

### 3.2 æ”¯æŒçš„æ•°æ®ç±»å‹

| æ•°æ®ç±»å‹ | API æ¥å£ | æ”¯æŒæƒ…å†µ | å¤‡æ³¨ |
|---------|---------|---------|------|
| **ETF å†å² K çº¿** | `query_history_k_data_plus()` | âœ… å®Œå…¨æ”¯æŒ | æ—¥/å‘¨/æœˆ/5/15/30/60 åˆ†é’Ÿ |
| **å‰å¤æƒ** | `adjustflag="2"` | âœ… å®Œå…¨æ”¯æŒ | æ¶¨è·Œå¹…å¤æƒæ³• |
| **ETF åŸºæœ¬ä¿¡æ¯** | `query_stock_basic(type=5)` | âœ… æ”¯æŒ | ä»£ç ã€åç§°ç­‰ |
| **å®æ—¶è¡Œæƒ…** | `query_real_time_price()` | âš ï¸ æœ‰å»¶è¿Ÿ | å…è´¹æœåŠ¡å»¶è¿Ÿæ˜æ˜¾ |
| **æŒ‡æ•°ä¼°å€¼** | - | âŒ ä¸æ”¯æŒ | æ—  PEã€è‚¡æ¯ç‡ç­‰ |
| **ETF ä»½é¢** | - | âŒ ä¸æ”¯æŒ | æ— ä»½é¢å˜åŒ–æ•°æ® |

### 3.3 æ•°æ®æ›´æ–°æœºåˆ¶

- **æ—¥çº¿æ•°æ®**: äº¤æ˜“æ—¥ç»“æŸåæ›´æ–°ï¼ˆéç›˜ä¸­å®æ—¶ï¼‰
- **åˆ†é’Ÿæ•°æ®**: æœ€ç»†ç²’åº¦ 5 åˆ†é’Ÿ K çº¿
- **å†å²èŒƒå›´**: è‚¡ç¥¨æ•°æ®å¯è¿½æº¯è‡³ 1990 å¹´ï¼ŒæŒ‡æ•°æ•°æ®è‡³ 2006 å¹´
- **æ•°æ®å»¶è¿Ÿ**: å…è´¹æœåŠ¡å­˜åœ¨å»¶è¿Ÿï¼Œä¸é€‚åˆå³æ—¶äº¤æ˜“åœºæ™¯

### 3.4 API ç¤ºä¾‹

```python
import baostock as bs
import pandas as pd

# ç™»å½•
lg = bs.login()

# è·å– ETF å‰å¤æƒæ—¥ K çº¿æ•°æ®
rs = bs.query_history_k_data_plus(
    "sh.510300",  # æ²ªæ·± 300 ETF
    "date,code,open,high,low,close,volume,amount,pctChg",
    start_date='2023-01-01',
    end_date='2026-02-16',
    frequency="d",       # æ—¥ K çº¿
    adjustflag="2"       # å‰å¤æƒ
)

# å¤„ç†æ•°æ®
data_list = []
while rs.next():
    data_list.append(rs.get_row_data())
df = pd.DataFrame(data_list, columns=rs.fields)

# ç™»å‡º
bs.logout()
```

---

## 4. å¯¹æ¯”åˆ†æ

### 4.1 åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ

| åŠŸèƒ½ | ä¸œæ–¹è´¢å¯Œï¼ˆAkShareï¼‰ | Baostock | æ›¿ä»£å¯è¡Œæ€§ |
|------|-------------------|----------|-----------|
| **ETF å®æ—¶è¡Œæƒ…** | âœ… å®Œæ•´ | âš ï¸ æœ‰å»¶è¿Ÿ | ğŸŸ¡ éƒ¨åˆ†å¯è¡Œ |
| **ETF å†å²æ•°æ®ï¼ˆå‰å¤æƒï¼‰** | âœ… å®Œæ•´ | âœ… å®Œæ•´ | ğŸŸ¢ å®Œå…¨å¯è¡Œ |
| **æŒ‡æ•°ä¼°å€¼æ•°æ®** | âœ… å®Œæ•´ | âŒ ä¸æ”¯æŒ | ğŸ”´ æ— æ³•æ›¿ä»£ |
| **ETF ä»½é¢æ•°æ®** | âœ… å®Œæ•´ | âŒ ä¸æ”¯æŒ | ğŸ”´ æ— æ³•æ›¿ä»£ |
| **æ•°æ®ç¨³å®šæ€§** | ğŸ”´ ä¸ç¨³å®š | ğŸŸ¢ ç¨³å®š | ğŸŸ¢ ä¼˜åŠ¿æ˜æ˜¾ |
| **æ•°æ®ä¸°å¯Œåº¦** | ğŸŸ¢ ä¸°å¯Œ | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¡ æœ‰é™åˆ¶ |
| **API æ˜“ç”¨æ€§** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ ç®€æ´ | ğŸŸ¢ ä¼˜åŠ¿æ˜æ˜¾ |

### 4.2 ç¨³å®šæ€§å¯¹æ¯”

**Baostock ä¼˜åŠ¿**:
- å®˜æ–¹æ•°æ®æºï¼Œä¸è§¦å‘åçˆ¬è™«
- æœåŠ¡å™¨ç¨³å®šæ€§å¥½ï¼Œè¾ƒå°‘å‡ºç°è¿æ¥å¤±è´¥
- å¤šå¹´è¿è¥ï¼ŒåŸºæœ¬æ•°æ®å‡†ç¡®æ€§é«˜

**AkShare åŠ£åŠ¿**:
- å¤šæºæŠ“å–ï¼Œå®¹æ˜“è§¦å‘åçˆ¬è™«ç­–ç•¥
- éœ€è¦é¢‘ç¹å‡çº§åº“ç‰ˆæœ¬åº”å¯¹æ•°æ®æºå˜åŒ–
- è¿ç»­è°ƒç”¨æ—¶å®¹æ˜“å‡ºç° `None` å€¼æˆ–è¿æ¥ä¸­æ–­

**æ•°æ®æ¥æº**: [CSDN - Baostock vs AkShare å¯¹æ¯”](https://csdn.net)

### 4.3 å…³é”®é™åˆ¶

**Baostock æ— æ³•æä¾›çš„æ•°æ®**:
1. **ETF ä»½é¢æ•°æ®** - é¡¹ç›®ç”¨äºèµ„é‡‘æµå‘åˆ†æï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
2. **æŒ‡æ•°ä¼°å€¼æ•°æ®** - é¡¹ç›®ç”¨äºä¼°å€¼åˆ†æï¼ˆPE ç™¾åˆ†ä½ã€è‚¡æ¯ç‡ï¼‰
3. **å®æ—¶è¡Œæƒ…** - å…è´¹æœåŠ¡å»¶è¿Ÿæ˜æ˜¾ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ

**ç»“è®º**: Baostock æ— æ³•ä½œä¸º**å®Œå…¨æ›¿ä»£æ–¹æ¡ˆ**ã€‚

---

## 5. æ¨èæ–¹æ¡ˆ

### 5.1 æ–¹æ¡ˆä¸€ï¼šæ··åˆä½¿ç”¨ï¼ˆæ¨èï¼‰â­

**æ¶æ„è®¾è®¡**:
```
å†å²æ•°æ®å±‚ï¼šBaostockï¼ˆä¸»ï¼‰ â†’ AkShareï¼ˆå¤‡ç”¨ï¼‰ â†’ ç£ç›˜ç¼“å­˜ â†’ æœ¬åœ°å…œåº•
å®æ—¶è¡Œæƒ…å±‚ï¼šAkShareï¼ˆä¸»ï¼‰ â†’ Sinaï¼ˆå¤‡ç”¨ï¼‰ â†’ THSï¼ˆå¤‡ç”¨ï¼‰ â†’ ç£ç›˜ç¼“å­˜
ç‰¹æ®Šæ•°æ®å±‚ï¼šAkShareï¼ˆå”¯ä¸€ï¼‰- ä¼°å€¼æ•°æ®ã€ä»½é¢æ•°æ®
```

**ä¼˜åŠ¿**:
- âœ… å†å²æ•°æ®ç¨³å®šæ€§å¤§å¹…æå‡ï¼ˆBaostock å®˜æ–¹æ•°æ®æºï¼‰
- âœ… ä¿ç•™ AkShare çš„æ•°æ®ä¸°å¯Œåº¦ï¼ˆä¼°å€¼ã€ä»½é¢ï¼‰
- âœ… é™ä½å¯¹å•ä¸€æ•°æ®æºçš„ä¾èµ–é£é™©
- âœ… æ¸è¿›å¼è¿ç§»ï¼Œé£é™©å¯æ§

**åŠ£åŠ¿**:
- âš ï¸ éœ€è¦ç»´æŠ¤ä¸¤å¥—æ•°æ®æºæ¥å£
- âš ï¸ ä»£ç å¤æ‚åº¦ç•¥æœ‰å¢åŠ 

**å®æ–½éš¾åº¦**: ğŸŸ¡ ä¸­ç­‰ï¼ˆ1-2 å‘¨ï¼‰

### 5.2 æ–¹æ¡ˆäºŒï¼šä¿æŒç°çŠ¶ + ä¼˜åŒ–

**ä¼˜åŒ–æªæ–½**:
- âœ… å·²å®ç°ï¼šå¤šæºå¤‡ç”¨ï¼ˆSinaã€THSï¼‰
- âœ… å·²å®ç°ï¼šé‡è¯•æœºåˆ¶ï¼ˆ2-3 æ¬¡ï¼Œ60 ç§’é—´éš”ï¼‰
- âœ… å·²å®ç°ï¼šç£ç›˜ç¼“å­˜ + æœ¬åœ°å…œåº•
- ğŸ†• å¯å¢åŠ ï¼šè¯·æ±‚é¢‘ç‡æ§åˆ¶ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰
- ğŸ†• å¯å¢åŠ ï¼šUser-Agent è½®æ¢æ± 
- ğŸ†• å¯å¢åŠ ï¼šä»£ç†æ± ï¼ˆå¦‚éœ€è¦ï¼‰

**ä¼˜åŠ¿**:
- âœ… æ— éœ€å¼•å…¥æ–°ä¾èµ–
- âœ… ä»£ç æ”¹åŠ¨æœ€å°

**åŠ£åŠ¿**:
- âš ï¸ æ ¹æœ¬é—®é¢˜æœªè§£å†³ï¼ˆåçˆ¬è™«ï¼‰
- âš ï¸ é•¿æœŸç»´æŠ¤æˆæœ¬é«˜

**å®æ–½éš¾åº¦**: ğŸŸ¢ ä½ï¼ˆ3-5 å¤©ï¼‰

### 5.3 æ–¹æ¡ˆä¸‰ï¼šå®Œå…¨è¿ç§»åˆ° Baostockï¼ˆä¸æ¨èï¼‰

**ä¸å¯è¡ŒåŸå› **:
- âŒ ç¼ºå°‘ ETF ä»½é¢æ•°æ®ï¼ˆèµ„é‡‘æµå‘åˆ†ææ ¸å¿ƒåŠŸèƒ½ï¼‰
- âŒ ç¼ºå°‘æŒ‡æ•°ä¼°å€¼æ•°æ®ï¼ˆä¼°å€¼åˆ†ææ ¸å¿ƒåŠŸèƒ½ï¼‰
- âŒ å®æ—¶æ•°æ®å»¶è¿Ÿå½±å“ç”¨æˆ·ä½“éªŒ

**ç»“è®º**: **ä¸æ¨è**æ­¤æ–¹æ¡ˆã€‚

---

## 6. å®æ–½æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆä¸€ï¼‰

### 6.1 æŠ€æœ¯å®ç°

#### 6.1.1 æ–°å»º Baostock æœåŠ¡

**æ–‡ä»¶**: `backend/app/services/baostock_service.py`

```python
import baostock as bs
import pandas as pd
from typing import Optional
import logging

logger = logging.getLogger(__name__)

class BaostockService:
    """Baostock æ•°æ®æœåŠ¡ï¼ˆå®˜æ–¹æ•°æ®æºï¼Œç¨³å®šæ€§é«˜ï¼‰"""

    @staticmethod
    def fetch_etf_history(
        code: str,
        start_date: str,
        end_date: str,
        adjust: str = "qfq"  # å‰å¤æƒ
    ) -> Optional[pd.DataFrame]:
        """
        è·å– ETF å†å²æ•°æ®ï¼ˆå‰å¤æƒï¼‰

        Args:
            code: ETF ä»£ç ï¼ˆå¦‚ 512690ï¼‰
            start_date: å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
            end_date: ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
            adjust: å¤æƒç±»å‹ï¼ˆqfq=å‰å¤æƒï¼‰

        Returns:
            DataFrame æˆ– Noneï¼ˆå¤±è´¥æ—¶ï¼‰
        """
        try:
            # ç™»å½•
            lg = bs.login()
            if lg.error_code != '0':
                logger.error(f"Baostock ç™»å½•å¤±è´¥: {lg.error_msg}")
                return None

            # è½¬æ¢ä»£ç æ ¼å¼ï¼š512690 -> sh.512690 æˆ– sz.159915
            bs_code = f"sh.{code}" if code.startswith('5') else f"sz.{code}"

            # æŸ¥è¯¢å†å²æ•°æ®
            rs = bs.query_history_k_data_plus(
                bs_code,
                "date,open,high,low,close,volume,amount,pctChg",
                start_date=start_date,
                end_date=end_date,
                frequency="d",
                adjustflag="2"  # å‰å¤æƒ
            )

            if rs.error_code != '0':
                logger.error(f"Baostock æŸ¥è¯¢å¤±è´¥: {rs.error_msg}")
                bs.logout()
                return None

            # æå–æ•°æ®
            data_list = []
            while rs.next():
                data_list.append(rs.get_row_data())

            bs.logout()

            if not data_list:
                logger.warning(f"Baostock è¿”å›ç©ºæ•°æ®: {code}")
                return None

            # è½¬æ¢ä¸º DataFrame
            df = pd.DataFrame(data_list, columns=rs.fields)

            # è½¬æ¢ä¸ºé¡¹ç›®ç»Ÿä¸€æ ¼å¼ï¼ˆä¸ AkShare ä¿æŒä¸€è‡´ï¼‰
            df = df.rename(columns={
                'date': 'æ—¥æœŸ',
                'open': 'å¼€ç›˜',
                'high': 'æœ€é«˜',
                'low': 'æœ€ä½',
                'close': 'æ”¶ç›˜',
                'volume': 'æˆäº¤é‡',
                'amount': 'æˆäº¤é¢',
                'pctChg': 'æ¶¨è·Œå¹…'
            })

            # æ•°æ®ç±»å‹è½¬æ¢
            df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'])
            for col in ['å¼€ç›˜', 'æœ€é«˜', 'æœ€ä½', 'æ”¶ç›˜', 'æˆäº¤é‡', 'æˆäº¤é¢', 'æ¶¨è·Œå¹…']:
                df[col] = pd.to_numeric(df[col], errors='coerce')

            logger.info(f"âœ… Baostock è·å–æˆåŠŸ: {code}, æ•°æ®é‡: {len(df)}")
            return df

        except Exception as e:
            logger.error(f"Baostock å¼‚å¸¸: {code}, {str(e)}")
            try:
                bs.logout()
            except:
                pass
            return None
```

#### 6.1.2 ä¿®æ”¹ AkShare æœåŠ¡

**æ–‡ä»¶**: `backend/app/services/akshare_service.py`

```python
from .baostock_service import BaostockService

def fetch_history_raw(
    code: str,
    start_date: str,
    end_date: str,
    adjust: str = "qfq"
) -> pd.DataFrame:
    """
    è·å– ETF å†å²æ•°æ®ï¼ˆå¤šæºé™çº§ç­–ç•¥ï¼‰

    ä¼˜å…ˆçº§ï¼š
    1. Baostockï¼ˆå®˜æ–¹æ•°æ®æºï¼Œç¨³å®šæ€§é«˜ï¼‰
    2. AkShare EastMoneyï¼ˆæ•°æ®ä¸°å¯Œï¼Œä½†ä¸ç¨³å®šï¼‰
    3. ç£ç›˜ç¼“å­˜ï¼ˆ7 å¤©è¿‡æœŸï¼‰
    4. è¿‡æœŸç£ç›˜ç¼“å­˜ï¼ˆæ°¸ä¹…å…œåº•ï¼‰
    """

    # 1. å°è¯• Baostockï¼ˆä¼˜å…ˆï¼Œç¨³å®šæ€§é«˜ï¼‰
    logger.info(f"ğŸ” å°è¯• Baostock è·å–å†å²æ•°æ®: {code}")
    df = BaostockService.fetch_etf_history(code, start_date, end_date, adjust)
    if df is not None and not df.empty:
        logger.info(f"âœ… Baostock è·å–æˆåŠŸ: {code}")
        # å†™å…¥ç£ç›˜ç¼“å­˜
        _cache_history_data(code, df, adjust)
        return df

    # 2. é™çº§åˆ° AkShare EastMoneyï¼ˆåŸæœ‰é€»è¾‘ï¼‰
    logger.warning(f"âš ï¸ Baostock å¤±è´¥ï¼Œé™çº§åˆ° AkShare: {code}")
    for attempt in range(3):
        try:
            df = ak.fund_etf_hist_em(
                symbol=code,
                period="daily",
                adjust=adjust
            )
            if not df.empty:
                logger.info(f"âœ… AkShare è·å–æˆåŠŸ: {code}, å°è¯•æ¬¡æ•°: {attempt + 1}")
                _cache_history_data(code, df, adjust)
                return df
        except Exception as e:
            logger.error(f"âŒ AkShare è·å–å¤±è´¥: {code}, å°è¯• {attempt + 1}/3, é”™è¯¯: {str(e)}")
            if attempt < 2:
                time.sleep(60)  # é‡è¯•é—´éš” 60 ç§’

    # 3. ç£ç›˜ç¼“å­˜å…œåº•ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
    logger.warning(f"âš ï¸ AkShare å¤±è´¥ï¼Œå°è¯•ç£ç›˜ç¼“å­˜: {code}")
    df = _load_cached_history(code, adjust, allow_expired=False)
    if df is not None:
        logger.info(f"âœ… ç£ç›˜ç¼“å­˜å‘½ä¸­: {code}")
        return df

    # 4. è¿‡æœŸç£ç›˜ç¼“å­˜å…œåº•ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
    logger.warning(f"âš ï¸ ç£ç›˜ç¼“å­˜æœªå‘½ä¸­ï¼Œå°è¯•è¿‡æœŸç¼“å­˜: {code}")
    df = _load_cached_history(code, adjust, allow_expired=True)
    if df is not None:
        logger.info(f"âœ… è¿‡æœŸç¼“å­˜å‘½ä¸­: {code}")
        return df

    # 5. æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥
    logger.error(f"âŒ æ‰€æœ‰æ•°æ®æºéƒ½å¤±è´¥: {code}")
    return pd.DataFrame()
```

### 6.2 å®æ–½æ­¥éª¤

#### é˜¶æ®µä¸€ï¼šæµ‹è¯•ç¯å¢ƒé›†æˆï¼ˆ1 å‘¨ï¼‰

1. **å®‰è£…ä¾èµ–**
   ```bash
   cd backend
   pip install baostock
   ```

2. **åˆ›å»º Baostock æœåŠ¡**
   - æ–°å»º `backend/app/services/baostock_service.py`
   - å®ç° `fetch_etf_history()` æ–¹æ³•

3. **ä¿®æ”¹ AkShare æœåŠ¡**
   - ä¿®æ”¹ `fetch_history_raw()` æ–¹æ³•
   - æ·»åŠ  Baostock ä¼˜å…ˆçº§

4. **å•å…ƒæµ‹è¯•**
   ```python
   # backend/tests/test_baostock_service.py
   def test_fetch_etf_history():
       df = BaostockService.fetch_etf_history(
           code="512690",
           start_date="2024-01-01",
           end_date="2024-12-31"
       )
       assert df is not None
       assert not df.empty
       assert 'æ—¥æœŸ' in df.columns
       assert 'æ”¶ç›˜' in df.columns
   ```

5. **æ•°æ®ä¸€è‡´æ€§éªŒè¯**
   - å¯¹æ¯” Baostock å’Œ AkShare çš„å†å²æ•°æ®
   - éªŒè¯å‰å¤æƒè®¡ç®—æ˜¯å¦ä¸€è‡´
   - æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼ˆç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ï¼‰

#### é˜¶æ®µäºŒï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆ1 å‘¨ï¼‰

1. **ç°åº¦å‘å¸ƒ**
   - 10% æµé‡ä½¿ç”¨ Baostock
   - ç›‘æ§æ•°æ®è·å–æˆåŠŸç‡
   - ç›‘æ§å“åº”æ—¶é—´

2. **ç›‘æ§æŒ‡æ ‡**
   ```python
   # æ·»åŠ ç›‘æ§åŸ‹ç‚¹
   metrics = {
       "baostock_success_rate": 0.0,  # Baostock æˆåŠŸç‡
       "baostock_avg_latency": 0.0,   # Baostock å¹³å‡å»¶è¿Ÿ
       "akshare_fallback_rate": 0.0,  # AkShare é™çº§ç‡
       "cache_hit_rate": 0.0          # ç¼“å­˜å‘½ä¸­ç‡
   }
   ```

3. **é€æ­¥æ‰©å¤§æµé‡**
   - 50% æµé‡ï¼ˆ3 å¤©ï¼‰
   - 100% æµé‡ï¼ˆç¨³å®šåï¼‰

4. **å›æ»šé¢„æ¡ˆ**
   - ä¿ç•™ AkShare ä¼˜å…ˆçš„ä»£ç åˆ†æ”¯
   - é€šè¿‡é…ç½®å¼€å…³å¿«é€Ÿåˆ‡æ¢

#### é˜¶æ®µä¸‰ï¼šæŒç»­ä¼˜åŒ–ï¼ˆæŒç»­ï¼‰

1. **ç›‘æ§æ•°æ®è´¨é‡**
   - æ¯æ—¥æ•°æ®è·å–æˆåŠŸç‡æŠ¥å‘Š
   - æ•°æ®æºæ•…éšœå‘Šè­¦

2. **æ¢ç´¢å…¶ä»–æ•°æ®æº**
   - Tushare Proï¼ˆä»˜è´¹ï¼Œç¨³å®šæ€§é«˜ï¼‰
   - JoinQuantï¼ˆé‡åŒ–å¹³å°ï¼‰
   - è‡ªå»ºæ•°æ®çˆ¬è™«ï¼ˆæœ€åæ‰‹æ®µï¼‰

3. **æ–‡æ¡£æ›´æ–°**
   - æ›´æ–° `AGENTS.md` æ•°æ®æºè¯´æ˜
   - æ›´æ–° `API_REFERENCE.md` æ¥å£æ–‡æ¡£

### 6.3 é£é™©è¯„ä¼°

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| Baostock æ•°æ®ä¸ä¸€è‡´ | ğŸ”´ é«˜ | ğŸŸ¡ ä¸­ | é˜¶æ®µä¸€å……åˆ†éªŒè¯æ•°æ®ä¸€è‡´æ€§ |
| Baostock æœåŠ¡ä¸­æ–­ | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | ä¿ç•™ AkShare é™çº§æœºåˆ¶ |
| ä»£ç  Bug å¯¼è‡´æœåŠ¡å¼‚å¸¸ | ğŸ”´ é«˜ | ğŸŸ¡ ä¸­ | å……åˆ†å•å…ƒæµ‹è¯• + ç°åº¦å‘å¸ƒ |
| ç”¨æˆ·ä½“éªŒä¸‹é™ | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | ç›‘æ§å“åº”æ—¶é—´ï¼ŒåŠæ—¶å›æ»š |

### 6.4 æˆåŠŸæŒ‡æ ‡

- âœ… å†å²æ•°æ®è·å–æˆåŠŸç‡ > 95%ï¼ˆå½“å‰çº¦ 80-85%ï¼‰
- âœ… Baostock æˆåŠŸç‡ > 90%
- âœ… AkShare é™çº§ç‡ < 10%
- âœ… å¹³å‡å“åº”æ—¶é—´ < 3 ç§’
- âœ… æ— ç”¨æˆ·æŠ•è¯‰æ•°æ®å¼‚å¸¸

---

## 7. é•¿æœŸè§„åˆ’

### 7.1 æ•°æ®æºå¤šå…ƒåŒ–

**ç›®æ ‡**: é™ä½å¯¹å•ä¸€æ•°æ®æºçš„ä¾èµ–

**å€™é€‰æ•°æ®æº**:
1. **Tushare Pro** - ä»˜è´¹ï¼Œç¨³å®šæ€§é«˜ï¼Œæ•°æ®ä¸°å¯Œ
2. **JoinQuant** - é‡åŒ–å¹³å°ï¼Œæä¾› API
3. **Wind / Choice** - å•†ä¸šç»ˆç«¯ï¼Œæˆæœ¬é«˜
4. **è‡ªå»ºçˆ¬è™«** - æœ€åæ‰‹æ®µï¼Œç»´æŠ¤æˆæœ¬é«˜

### 7.2 æ•°æ®è´¨é‡ç›‘æ§

**ç›‘æ§ç»´åº¦**:
- æ•°æ®è·å–æˆåŠŸç‡
- æ•°æ®æ›´æ–°åŠæ—¶æ€§
- æ•°æ®ä¸€è‡´æ€§ï¼ˆå¤šæºå¯¹æ¯”ï¼‰
- å¼‚å¸¸å€¼æ£€æµ‹

**å‘Šè­¦æœºåˆ¶**:
- æˆåŠŸç‡ < 90% è§¦å‘å‘Šè­¦
- æ•°æ®å»¶è¿Ÿ > 1 å¤©è§¦å‘å‘Šè­¦
- æ•°æ®å¼‚å¸¸ï¼ˆå¦‚æ¶¨è·Œå¹… > 20%ï¼‰è§¦å‘äººå·¥å®¡æ ¸

### 7.3 æŠ€æœ¯å€ºåŠ¡æ¸…ç†

**å¾…ä¼˜åŒ–é¡¹**:
1. ç»Ÿä¸€æ•°æ®æ ¼å¼è½¬æ¢é€»è¾‘ï¼ˆé¿å…é‡å¤ä»£ç ï¼‰
2. æŠ½è±¡æ•°æ®æºæ¥å£ï¼ˆä¾¿äºæ–°å¢æ•°æ®æºï¼‰
3. ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ï¼ˆRedis æ›¿ä»£ç£ç›˜ç¼“å­˜ï¼‰
4. å¢åŠ æ•°æ®ç‰ˆæœ¬ç®¡ç†ï¼ˆæ”¯æŒæ•°æ®å›æº¯ï¼‰

---

## 8. å‚è€ƒèµ„æ–™

### 8.1 å®˜æ–¹æ–‡æ¡£
- [Baostock å®˜æ–¹ç½‘ç«™](http://baostock.com)
- [Baostock Python API æ–‡æ¡£](http://baostock.com/baostock/index.php/Python_API%E6%96%87%E6%A1%A3)
- [AkShare å®˜æ–¹æ–‡æ¡£](https://akshare.akfamily.xyz/)

### 8.2 æŠ€æœ¯æ–‡ç« 
- [SegmentFault - Baostock ä½¿ç”¨æŒ‡å—](https://segmentfault.com)
- [CSDN - Baostock vs AkShare å¯¹æ¯”](https://csdn.net)
- [çŸ¥ä¹ - Python é‡‘èæ•°æ®æ¥å£å¯¹æ¯”](https://zhihu.com)

### 8.3 é¡¹ç›®å†…éƒ¨æ–‡æ¡£
- `AGENTS.md` - é¡¹ç›®å¼€å‘è§„èŒƒ
- `docs/planning/PRD.md` - äº§å“éœ€æ±‚æ–‡æ¡£
- `backend/app/services/akshare_service.py` - å½“å‰æ•°æ®æœåŠ¡å®ç°

---

## 9. é™„å½•

### 9.1 Baostock ä»£ç æ ¼å¼è½¬æ¢

| å¸‚åœº | é¡¹ç›®æ ¼å¼ | Baostock æ ¼å¼ | ç¤ºä¾‹ |
|------|---------|--------------|------|
| ä¸Šäº¤æ‰€ | 512690 | sh.512690 | é…’ ETF |
| æ·±äº¤æ‰€ | 159915 | sz.159915 | åˆ›ä¸šæ¿ ETF |

### 9.2 æ•°æ®å­—æ®µæ˜ å°„

| AkShare å­—æ®µ | Baostock å­—æ®µ | è¯´æ˜ |
|-------------|--------------|------|
| æ—¥æœŸ | date | äº¤æ˜“æ—¥æœŸ |
| å¼€ç›˜ | open | å¼€ç›˜ä»· |
| æœ€é«˜ | high | æœ€é«˜ä»· |
| æœ€ä½ | low | æœ€ä½ä»· |
| æ”¶ç›˜ | close | æ”¶ç›˜ä»· |
| æˆäº¤é‡ | volume | æˆäº¤é‡ï¼ˆæ‰‹ï¼‰ |
| æˆäº¤é¢ | amount | æˆäº¤é¢ï¼ˆå…ƒï¼‰ |
| æ¶¨è·Œå¹… | pctChg | æ¶¨è·Œå¹…ï¼ˆ%ï¼‰ |

### 9.3 å¤æƒæ–¹å¼å¯¹æ¯”

| å¤æƒæ–¹å¼ | AkShare å‚æ•° | Baostock å‚æ•° | è¯´æ˜ |
|---------|-------------|--------------|------|
| å‰å¤æƒ | adjust="qfq" | adjustflag="2" | é¡¹ç›®ä½¿ç”¨ |
| åå¤æƒ | adjust="hfq" | adjustflag="1" | ä¸ä½¿ç”¨ |
| ä¸å¤æƒ | adjust="" | adjustflag="3" | ä¸ä½¿ç”¨ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-16
**ç»´æŠ¤è€…**: ETFTools å¼€å‘å›¢é˜Ÿ
