# ETF 指数 PE 百分位数据源研究

> 研究日期：2026-01-28

## 研究目标

分析已映射的 ETF 指数（121 个唯一指数）是否有免费数据源支撑计算 **10 年 PE 百分位**。

## 数据需求

计算指数 10 年 PE 百分位需要：
- 指数历史 PE 数据（至少 10 年）
- 或：指数点位 + 成分股总市值 + 成分股总净利润（自行计算）

---

## 方案 A：AkShare 内置函数

### 测试函数

| 函数 | 数据来源 | 结果 |
|------|----------|------|
| `index_value_hist_funddb` | 韭圈儿 | ✗ AkShare 1.17.89 无此函数 |
| `stock_index_pe_lg` | 乐咕乐股 | ✓ 可用，但仅支持 12 个指数 |
| `stock_zh_index_value_csindex` | 中证官网 | △ 仅 20 条数据，不够 |
| `stock_market_pe_lg` | 乐咕乐股 | ✗ 仅市场整体 PE |

### stock_index_pe_lg 详情

**支持的指数（共 12 个）：**
- 上证50、沪深300、上证380、创业板50
- 中证500、上证180、深证红利、深证100
- 中证1000、上证红利、中证100、中证800

**数据质量：**
- 历史深度：10-20 年
- 更新频率：每日
- 数据字段：日期、指数、静态/滚动市盈率、中位数等

**覆盖率：**
- 已映射 121 个唯一指数
- 可覆盖：4 个（沪深300、中证500、上证180、创业板50）
- 覆盖率：3.3%

---

## 方案 B：第三方网站爬取

### 测试结果

| 数据源 | URL | 状态 | 说明 |
|--------|-----|------|------|
| 乌龟量化 | guorn.com | ✗ 404 | 页面不存在 |
| 韭圈儿 | funddb.cn | ✗ 404 | 页面不存在 |
| 且慢 | qieman.com | ✗ | 数据动态加载，无公开 API |
| 雪球 | xueqiu.com | ✗ | 需要登录认证 |
| 东方财富 | eastmoney.com | ✗ | 报表配置不存在 |
| 亿牛网 | eniu.com | ✗ 404 | 页面不存在 |
| DJyanbao | djyanbao.com | ✗ | 页面动态加载 |
| 理杏仁 | lixinger.com | ✗ | 需要 API 认证 |
| 同花顺 | iwencai.com | ✗ | 接口报错 |

### 结论

主流免费估值数据网站：
- 部分已关闭（乌龟量化、韭圈儿、亿牛网）
- 部分需要登录认证（雪球、理杏仁）
- 部分数据动态加载无公开 API（且慢、DJyanbao）

**方案 B 不可行**

---

## 方案 C：成分股加权计算（待测试）

### 思路

1. 获取指数成分股列表：`ak.index_stock_cons(symbol='000300')`
2. 获取每只成分股的历史 PE
3. 按权重加权计算指数 PE

### 可行性

- ✓ 成分股列表可获取
- ? 个股历史 PE 数据源待确认
- ? 成分股权重数据待确认
- ✗ 工作量大，需要处理成分股调整

---

## 方案 D：付费数据源

| 数据源 | 费用 | 覆盖范围 |
|--------|------|----------|
| Tushare Pro | ~500 元/年 | 全面 |
| Wind | 较贵 | 专业级 |
| 聚宽 JQData | 按量计费 | 较全面 |

---

## 结论与建议

### 当前可行方案

1. **降级方案**：仅对 `stock_index_pe_lg` 支持的 12 个宽基指数提供 PE 百分位
   - 优点：实现简单，数据可靠
   - 缺点：覆盖率低（3.3%）

2. **方案 C**：成分股加权计算
   - 优点：覆盖面广
   - 缺点：实现复杂，需要处理成分股调整

3. **方案 D**：付费数据源
   - 优点：数据全面可靠
   - 缺点：有成本

### 推荐路径

1. **短期**：先实现降级方案，支持 12 个主流宽基指数
2. **中期**：评估方案 C 的可行性，扩展覆盖范围
3. **长期**：根据需求考虑付费数据源

---

## 附录：测试代码示例

```python
import akshare as ak

# 获取沪深300历史PE（乐咕乐股）
df = ak.stock_index_pe_lg(symbol='沪深300')
print(f'数据量: {len(df)} 条')
print(f'时间范围: {df["日期"].min()} ~ {df["日期"].max()}')
print(df.head())

# 输出示例：
# 数据量: 5057 条
# 时间范围: 2005-04-08 ~ 2026-01-27
# 列: 日期, 指数, 等权静态市盈率, 静态市盈率, 静态市盈率中位数,
#     等权滚动市盈率, 滚动市盈率, 滚动市盈率中位数
```

```python
# 支持的指数列表
supported = [
    "上证50", "沪深300", "上证380", "创业板50",
    "中证500", "上证180", "深证红利", "深证100",
    "中证1000", "上证红利", "中证100", "中证800"
]
```
